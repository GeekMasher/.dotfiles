#!/usr/bin/env bash

if [ -z "$1" ]; then
    # Ask for branch style
    STYLE=$(gum choose "feature" "username/feature" "fix" "version" "patch" --header "Select branch style:")
    
    # Ask for the name
    if [[ "$STYLE" == "feature" ]]; then
        NAME=$(gum input --placeholder "feature name")
        BRANCH="$NAME"
    elif [[ "$STYLE" == "username/feature" ]]; then
        NAME=$(gum input --placeholder "feature name")
        USERNAME=$(git config user.name | tr '[:upper:]' '[:lower:]' | tr ' ' '-')
        BRANCH="$USERNAME/$NAME"
    elif [[ "$STYLE" == "version" ]]; then
        NAME=$(gum input --placeholder "version")
        BRANCH="version/$NAME"
    elif [[ "$STYLE" == "fix" ]]; then
        NAME=$(gum input --placeholder "fix name")
        BRANCH="fix-$NAME"
    elif [[ "$STYLE" == "patch" ]]; then
        NAME=$(gum input --placeholder "patch name")
        BRANCH="patch-$NAME"
    fi
else
    BRANCH="$1"
fi

if git rev-parse --verify --quiet "refs/heads/$BRANCH"; then
    git checkout "$BRANCH"
    git pull origin "$BRANCH"
else
    git checkout -b "$BRANCH"
fi
git push --set-upstream origin "$BRANCH"
